using System.Linq;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using TensorShader;
using static TensorShader.Field;

namespace TensorShaderTest.Links.ComplexConvolution {
    [TestClass]
    public class ComplexDeconvolution2DTest {
        [TestMethod]
        public void ReferenceTest() {
            int inchannels = 6, outchannels = 8, kwidth = 3, kheight = 5, stride = 2, inwidth = 13, inheight = 17;
            int outwidth = (inwidth - kwidth) / stride + 1, outheight = (inheight - kheight) / stride + 1, batch = 3;

            float[] xval = (new float[inwidth * inheight * inchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] yval = (new float[outwidth * outheight * outchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] wval = (new float[kwidth * kheight * outchannels * inchannels / 2]).Select((_, idx) => idx * 1e-3f).Reverse().ToArray();

            Tensor xtensor = new Tensor(Shape.Map2D(inchannels, inwidth, inheight, batch), xval);
            Tensor ytensor = new Tensor(Shape.Map2D(outchannels, outwidth, outheight, batch), yval);
            Tensor wtensor = new Tensor(Shape.Kernel2D(inchannels, outchannels / 2, kwidth, kheight), wval);

            VariableField x_actual = xtensor;
            ParameterField w = wtensor;
            ParameterField y = ytensor;

            Field x_expect = ComplexDeconvolution2D(y, w, stride, Shape.Map2D(inchannels, inwidth, inheight, batch));
            Field err = x_expect - x_actual;

            (Flow flow, Parameters Parameters) = Flow.Optimize(err);

            flow.Execute();

            float[] gy_actual = y.GradTensor.State;
            float[] gw_actual = w.GradTensor.State;

            AssertError.Tolerance(gy_expect, gy_actual, 1e-7f, 1e-5f, $"not equal gy");

            AssertError.Tolerance(gw_expect, gw_actual, 1e-6f, 1e-4f, $"not equal gw"); /*backward tolerance*/
        }

        [TestMethod]
        public void TheoreticalTest() {
            int inchannels = 6, outchannels = 8, kwidth = 3, kheight = 5, stride = 2, inwidth = 13, inheight = 17;
            int outwidth = (inwidth - kwidth) / stride + 1, outheight = (inheight - kheight) / stride + 1, batch = 3;

            float[] xval = (new float[inwidth * inheight * inchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] yval = (new float[outwidth * outheight * outchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] wval = (new float[kwidth * kheight * outchannels * inchannels / 2]).Select((_, idx) => idx * 1e-3f).Reverse().ToArray();

            Tensor xtensor = new Tensor(Shape.Map2D(inchannels, inwidth, inheight, batch), xval);
            Tensor ytensor = new Tensor(Shape.Map2D(outchannels, outwidth, outheight, batch), yval);
            Tensor wtensor = new Tensor(Shape.Kernel2D(inchannels, outchannels / 2, kwidth, kheight), wval);

            VariableField x_actual = xtensor;
            ParameterField w = wtensor;
            ParameterField y = ytensor;

            Field y_real = ComplexReal(y), y_imag = ComplexImag(y);
            Field w_real = ComplexReal(w), w_imag = ComplexImag(w);

            Field x_real = Deconvolution2D(y_real, w_real, stride, Shape.Map2D(inchannels / 2, inwidth, inheight, batch))
                         - Deconvolution2D(y_imag, w_imag, stride, Shape.Map2D(inchannels / 2, inwidth, inheight, batch));

            Field x_imag = Deconvolution2D(y_imag, w_real, stride, Shape.Map2D(inchannels / 2, inwidth, inheight, batch))
                         + Deconvolution2D(y_real, w_imag, stride, Shape.Map2D(inchannels / 2, inwidth, inheight, batch));

            Field x_expect = ComplexCast(x_real, x_imag);

            Field err = x_expect - x_actual;

            (Flow flow, Parameters Parameters) = Flow.Optimize(err);

            flow.Execute();

            float[] gy_actual = y.GradTensor.State;
            float[] gw_actual = w.GradTensor.State;

            AssertError.Tolerance(gy_expect, gy_actual, 1e-7f, 1e-5f, $"not equal gy");

            AssertError.Tolerance(gw_expect, gw_actual, 1e-6f, 1e-4f, $"not equal gw"); /*backward tolerance*/
        }

        float[] gy_expect = new float[] {
            -1.057647840e+00f,  7.343771280e-01f,  -1.014434448e+00f,  6.880282800e-01f,  -9.712210560e-01f,  6.416794320e-01f,
            -9.280076640e-01f,  5.953305840e-01f,  -8.137061280e-01f,  1.191032220e+00f,  -7.830036720e-01f,  1.125519636e+00f,
            -7.523012160e-01f,  1.060007052e+00f,  -7.215987600e-01f,  9.944944680e-01f,  -6.972331680e-01f,  1.511158620e+00f,
            -6.714555120e-01f,  1.434293076e+00f,  -6.456778560e-01f,  1.357427532e+00f,  -6.199002000e-01f,  1.280561988e+00f,
            -5.807602080e-01f,  1.831285020e+00f,  -5.599073520e-01f,  1.743066516e+00f,  -5.390544960e-01f,  1.654848012e+00f,
            -5.182016400e-01f,  1.566629508e+00f,  -4.642872480e-01f,  2.151411420e+00f,  -4.483591920e-01f,  2.051839956e+00f,
            -4.324311360e-01f,  1.952268492e+00f,  -4.165030800e-01f,  1.852697028e+00f,  -8.458391040e-01f,  1.963290120e+00f,
            -8.081933280e-01f,  1.879222488e+00f,  -7.705475520e-01f,  1.795154856e+00f,  -7.329017760e-01f,  1.711087224e+00f,
            -2.132856288e+00f,  2.311291032e+00f,  -2.062661040e+00f,  2.207746248e+00f,  -1.992465792e+00f,  2.104201464e+00f,
            -1.922270544e+00f,  2.000656680e+00f,  -1.412207232e+00f,  3.246474792e+00f,  -1.368394224e+00f,  3.109936440e+00f,
            -1.324581216e+00f,  2.973398088e+00f,  -1.280768208e+00f,  2.836859736e+00f,  -1.204901472e+00f,  3.656993352e+00f,
            -1.167879504e+00f,  3.507253080e+00f,  -1.130857536e+00f,  3.357512808e+00f,  -1.093835568e+00f,  3.207772536e+00f,
            -9.975957120e-01f,  4.067511912e+00f,  -9.673647840e-01f,  3.904569720e+00f,  -9.371338560e-01f,  3.741627528e+00f,
            -9.069029280e-01f,  3.578685336e+00f,  -7.902899520e-01f,  4.478030472e+00f,  -7.668500640e-01f,  4.301886360e+00f,
            -7.434101760e-01f,  4.125742248e+00f,  -7.199702880e-01f,  3.949598136e+00f,  -1.568025792e+00f,  3.889952952e+00f,
            -1.506653712e+00f,  3.745516776e+00f,  -1.445281632e+00f,  3.601080600e+00f,  -1.383909552e+00f,  3.456644424e+00f,
            -2.797401376e+00f,  4.288932264e+00f,  -2.708791120e+00f,  4.119873528e+00f,  -2.620180864e+00f,  3.950814792e+00f,
            -2.531570608e+00f,  3.781756056e+00f,  -1.575503696e+00f,  5.724758700e+00f,  -1.527406904e+00f,  5.508661572e+00f,
            -1.479310112e+00f,  5.292564444e+00f,  -1.431213320e+00f,  5.076467316e+00f,  -1.356720976e+00f,  6.146469100e+00f,
            -1.315622584e+00f,  5.916968452e+00f,  -1.274524192e+00f,  5.687467804e+00f,  -1.233425800e+00f,  5.457967156e+00f,
            -1.137938256e+00f,  6.568179500e+00f,  -1.103838264e+00f,  6.325275332e+00f,  -1.069738272e+00f,  6.082371164e+00f,
            -1.035638280e+00f,  5.839466996e+00f,  -9.191555360e-01f,  6.989889900e+00f,  -8.920539440e-01f,  6.733582212e+00f,
            -8.649523520e-01f,  6.477274524e+00f,  -8.378507600e-01f,  6.220966836e+00f,  -2.187721792e+00f,  5.909693448e+00f,
            -2.104540912e+00f,  5.703164760e+00f,  -2.021360032e+00f,  5.496636072e+00f,  -1.938179152e+00f,  5.290107384e+00f,
            -3.405098752e+00f,  6.320934600e+00f,  -3.299101360e+00f,  6.085382424e+00f,  -3.193103968e+00f,  5.849830248e+00f,
            -3.087106576e+00f,  5.614278072e+00f,  -1.687867376e+00f,  8.251241100e+00f,  -1.636400984e+00f,  7.954722852e+00f,
            -1.584934592e+00f,  7.658204604e+00f,  -1.533468200e+00f,  7.361686356e+00f,  -1.469084656e+00f,  8.672951500e+00f,
            -1.424616664e+00f,  8.363029732e+00f,  -1.380148672e+00f,  8.053107964e+00f,  -1.335680680e+00f,  7.743186196e+00f,
            -1.250301936e+00f,  9.094661900e+00f,  -1.212832344e+00f,  8.771336612e+00f,  -1.175362752e+00f,  8.448011324e+00f,
            -1.137893160e+00f,  8.124686036e+00f,  -1.031519216e+00f,  9.516372300e+00f,  -1.001048024e+00f,  9.179643492e+00f,
            -9.705768320e-01f,  8.842914684e+00f,  -9.401056400e-01f,  8.506185876e+00f,  -2.801169952e+00f,  7.934507304e+00f,
            -2.696288848e+00f,  7.665798264e+00f,  -2.591407744e+00f,  7.397089224e+00f,  -2.486526640e+00f,  7.128380184e+00f,
            -4.012796128e+00f,  8.352936936e+00f,  -3.889411600e+00f,  8.050891320e+00f,  -3.766027072e+00f,  7.748845704e+00f,
            -3.642642544e+00f,  7.446800088e+00f,  -1.800231056e+00f,  1.077772350e+01f,  -1.745395064e+00f,  1.040078413e+01f,
            -1.690559072e+00f,  1.002384476e+01f,  -1.635723080e+00f,  9.646905396e+00f,  -1.581448336e+00f,  1.119943390e+01f,
            -1.533610744e+00f,  1.080909101e+01f,  -1.485773152e+00f,  1.041874812e+01f,  -1.437935560e+00f,  1.002840524e+01f,
            -1.362665616e+00f,  1.162114430e+01f,  -1.321826424e+00f,  1.121739789e+01f,  -1.280987232e+00f,  1.081365148e+01f,
            -1.240148040e+00f,  1.040990508e+01f,  -1.143882896e+00f,  1.204285470e+01f,  -1.110042104e+00f,  1.162570477e+01f,
            -1.076201312e+00f,  1.120855484e+01f,  -1.042360520e+00f,  1.079140492e+01f,  -3.414618112e+00f,  9.959321160e+00f,
            -3.288036784e+00f,  9.628431768e+00f,  -3.161455456e+00f,  9.297542376e+00f,  -3.034874128e+00f,  8.966652984e+00f,
            -5.035824480e+00f,  9.958827288e+00f,  -4.830223152e+00f,  9.655110984e+00f,  -4.624621824e+00f,  9.351394680e+00f,
            -4.419020496e+00f,  9.047678376e+00f,  -2.503670016e+00f,  1.269975185e+01f,  -2.364471408e+00f,  1.232336710e+01f,
            -2.225272800e+00f,  1.194698234e+01f,  -2.086074192e+00f,  1.157059759e+01f,  -2.298576096e+00f,  1.310750561e+01f,
            -2.164509648e+00f,  1.271957782e+01f,  -2.030443200e+00f,  1.233165002e+01f,  -1.896376752e+00f,  1.194372223e+01f,
            -2.093482176e+00f,  1.351525937e+01f,  -1.964547888e+00f,  1.311578854e+01f,  -1.835613600e+00f,  1.271631770e+01f,
            -1.706679312e+00f,  1.231684687e+01f,  -1.888388256e+00f,  1.392301313e+01f,  -1.764586128e+00f,  1.351199926e+01f,
            -1.640784000e+00f,  1.310098538e+01f,  -1.516981872e+00f,  1.268997151e+01f,  -4.609233984e+00f,  1.139172895e+01f,
            -4.391885712e+00f,  1.106769137e+01f,  -4.174537440e+00f,  1.074365378e+01f,  -3.957189168e+00f,  1.041961620e+01f,
            -8.844367392e+00f,  8.764926312e+00f,  -8.460191952e+00f,  8.555730744e+00f,  -8.076016512e+00f,  8.346535176e+00f,
            -7.691841072e+00f,  8.137339608e+00f,  -6.777536208e+00f,  1.103439318e+01f,  -6.434756952e+00f,  1.077755644e+01f,
            -6.091977696e+00f,  1.052071969e+01f,  -5.749198440e+00f,  1.026388295e+01f,  -6.666592848e+00f,  1.134760758e+01f,
            -6.324591192e+00f,  1.108356508e+01f,  -5.982589536e+00f,  1.081952257e+01f,  -5.640587880e+00f,  1.055548007e+01f,
            -6.555649488e+00f,  1.166082198e+01f,  -6.214425432e+00f,  1.138957372e+01f,  -5.873201376e+00f,  1.111832545e+01f,
            -5.531977320e+00f,  1.084707719e+01f,  -6.444706128e+00f,  1.197403638e+01f,  -6.104259672e+00f,  1.169558236e+01f,
            -5.763813216e+00f,  1.141712833e+01f,  -5.423366760e+00f,  1.113867431e+01f,  -8.948962368e+00f,  9.665934024e+00f,
            -8.540826480e+00f,  9.448547736e+00f,  -8.132690592e+00f,  9.231161448e+00f,  -7.724554704e+00f,  9.013775160e+00f,
            -1.288306594e+01f,  1.136897426e+01f,  -1.251746477e+01f,  1.093071502e+01f,  -1.215186360e+01f,  1.049245577e+01f,
            -1.178626243e+01f,  1.005419652e+01f,  -9.867071808e+00f,  1.459935102e+01f,  -9.599330952e+00f,  1.405701412e+01f,
            -9.331590096e+00f,  1.351467721e+01f,  -9.063849240e+00f,  1.297234031e+01f,  -9.750598848e+00f,  1.491947742e+01f,
            -9.487782792e+00f,  1.436578756e+01f,  -9.224966736e+00f,  1.381209769e+01f,  -8.962150680e+00f,  1.325840783e+01f,
            -9.634125888e+00f,  1.523960382e+01f,  -9.376234632e+00f,  1.467456100e+01f,  -9.118343376e+00f,  1.410951817e+01f,
            -8.860452120e+00f,  1.354447535e+01f,  -9.517652928e+00f,  1.555973022e+01f,  -9.264686472e+00f,  1.498333444e+01f,
            -9.011720016e+00f,  1.440693865e+01f,  -8.758753560e+00f,  1.383054287e+01f,  -1.242043454e+01f,  1.284174262e+01f,
            -1.203949910e+01f,  1.238666647e+01f,  -1.165856366e+01f,  1.193159033e+01f,  -1.127762822e+01f,  1.147651418e+01f,
            -1.080410530e+01f,  1.608641297e+01f,  -1.047771158e+01f,  1.552534908e+01f,  -1.015131787e+01f,  1.496428519e+01f,
            -9.824924160e+00f,  1.440322130e+01f,  -6.650595312e+00f,  2.045126431e+01f,  -6.448125984e+00f,  1.976024532e+01f,
            -6.245656656e+00f,  1.906922633e+01f,  -6.043187328e+00f,  1.837820734e+01f,  -6.443289552e+00f,  2.086178287e+01f,
            -6.247611264e+00f,  2.015756196e+01f,  -6.051932976e+00f,  1.945334105e+01f,  -5.856254688e+00f,  1.874912014e+01f,
            -6.235983792e+00f,  2.127230143e+01f,  -6.047096544e+00f,  2.055487860e+01f,  -5.858209296e+00f,  1.983745577e+01f,
            -5.669322048e+00f,  1.912003294e+01f,  -6.028678032e+00f,  2.168281999e+01f,  -5.846581824e+00f,  2.095219524e+01f,
            -5.664485616e+00f,  2.022157049e+01f,  -5.482389408e+00f,  1.949094574e+01f,  -1.016495698e+01f,  1.773010298e+01f,
            -9.819517248e+00f,  1.715601689e+01f,  -9.474077520e+00f,  1.658193079e+01f,  -9.128637792e+00f,  1.600784470e+01f,
            -1.102109301e+01f,  1.850241862e+01f,  -1.068441280e+01f,  1.786790580e+01f,  -1.034773259e+01f,  1.723339298e+01f,
            -1.001105238e+01f,  1.659888017e+01f,  -6.331859456e+00f,  2.339960550e+01f,  -6.133815464e+00f,  2.262056053e+01f,
            -5.935771472e+00f,  2.184151556e+01f,  -5.737727480e+00f,  2.106247060e+01f,  -6.113076736e+00f,  2.382131590e+01f,
            -5.922031144e+00f,  2.302886741e+01f,  -5.730985552e+00f,  2.223641892e+01f,  -5.539939960e+00f,  2.144397044e+01f,
            -5.894294016e+00f,  2.424302630e+01f,  -5.710246824e+00f,  2.343717429e+01f,  -5.526199632e+00f,  2.263132228e+01f,
            -5.342152440e+00f,  2.182547028e+01f,  -5.675511296e+00f,  2.466473670e+01f,  -5.498462504e+00f,  2.384548117e+01f,
            -5.321413712e+00f,  2.302622564e+01f,  -5.144364920e+00f,  2.220697012e+01f,  -1.045166891e+01f,  2.007286044e+01f,
            -1.009022646e+01f,  1.943106929e+01f,  -9.728784016e+00f,  1.878927814e+01f,  -9.367341568e+00f,  1.814748698e+01f,
            -1.162879038e+01f,  2.053442095e+01f,  -1.127472304e+01f,  1.983341470e+01f,  -1.092065570e+01f,  1.913240844e+01f,
            -1.056658835e+01f,  1.843140218e+01f,  -6.444223136e+00f,  2.592608790e+01f,  -6.242809544e+00f,  2.506662181e+01f,
            -6.041395952e+00f,  2.420715572e+01f,  -5.839982360e+00f,  2.334768964e+01f,  -6.225440416e+00f,  2.634779830e+01f,
            -6.031025224e+00f,  2.547492869e+01f,  -5.836610032e+00f,  2.460205908e+01f,  -5.642194840e+00f,  2.372918948e+01f,
            -6.006657696e+00f,  2.676950870e+01f,  -5.819240904e+00f,  2.588323557e+01f,  -5.631824112e+00f,  2.499696244e+01f,
            -5.444407320e+00f,  2.411068932e+01f,  -5.787874976e+00f,  2.719121910e+01f,  -5.607456584e+00f,  2.629154245e+01f,
            -5.427038192e+00f,  2.539186580e+01f,  -5.246619800e+00f,  2.449218916e+01f,  -1.106511707e+01f,  2.209767430e+01f,
            -1.068197440e+01f,  2.139370279e+01f,  -1.029883173e+01f,  2.068973129e+01f,  -9.915689056e+00f,  1.998575978e+01f,
            -1.223648776e+01f,  2.256642329e+01f,  -1.186503328e+01f,  2.179892359e+01f,  -1.149357880e+01f,  2.103142390e+01f,
            -1.112212432e+01f,  2.026392420e+01f,  -6.556586816e+00f,  2.845257030e+01f,  -6.351803624e+00f,  2.751268309e+01f,
            -6.147020432e+00f,  2.657279588e+01f,  -5.942237240e+00f,  2.563290868e+01f,  -6.337804096e+00f,  2.887428070e+01f,
            -6.140019304e+00f,  2.792098997e+01f,  -5.942234512e+00f,  2.696769924e+01f,  -5.744449720e+00f,  2.601440852e+01f,
            -6.119021376e+00f,  2.929599110e+01f,  -5.928234984e+00f,  2.832929685e+01f,  -5.737448592e+00f,  2.736260260e+01f,
            -5.546662200e+00f,  2.639590836e+01f,  -5.900238656e+00f,  2.971770150e+01f,  -5.716450664e+00f,  2.873760373e+01f,
            -5.532662672e+00f,  2.775750596e+01f,  -5.348874680e+00f,  2.677740820e+01f,  -1.167856523e+01f,  2.412248815e+01f,
            -1.127372234e+01f,  2.335633630e+01f,  -1.086887944e+01f,  2.259018444e+01f,  -1.046403654e+01f,  2.182403258e+01f,
            -1.366991458e+01f,  2.375252868e+01f,  -1.315237642e+01f,  2.304703164e+01f,  -1.263483826e+01f,  2.234153460e+01f,
            -1.211730010e+01f,  2.163603756e+01f,  -7.834955376e+00f,  2.978841977e+01f,  -7.467427488e+00f,  2.892722734e+01f,
            -7.099899600e+00f,  2.806603490e+01f,  -6.732371712e+00f,  2.720484247e+01f,  -7.629861456e+00f,  3.019617353e+01f,
            -7.267465728e+00f,  2.932343806e+01f,  -6.905070000e+00f,  2.845070258e+01f,  -6.542674272e+00f,  2.757796711e+01f,
            -7.424767536e+00f,  3.060392729e+01f,  -7.067503968e+00f,  2.971964878e+01f,  -6.710240400e+00f,  2.883537026e+01f,
            -6.352976832e+00f,  2.795109175e+01f,  -7.219673616e+00f,  3.101168105e+01f,  -6.867542208e+00f,  3.011585950e+01f,
            -6.515410800e+00f,  2.922003794e+01f,  -6.163279392e+00f,  2.832421639e+01f,  -1.339195973e+01f,  2.502750497e+01f,
            -1.283480544e+01f,  2.432955583e+01f,  -1.227765115e+01f,  2.363160670e+01f,  -1.172049686e+01f,  2.293365756e+01f,
            -2.057688821e+01f,  1.944597209e+01f,  -1.973097907e+01f,  1.898421204e+01f,  -1.888506994e+01f,  1.852245199e+01f,
            -1.803916080e+01f,  1.806069194e+01f,  -1.606314509e+01f,  2.415240798e+01f,  -1.530914503e+01f,  2.359292932e+01f,
            -1.455514498e+01f,  2.303345065e+01f,  -1.380114492e+01f,  2.247397199e+01f,  -1.595220173e+01f,  2.446562238e+01f,
            -1.519897927e+01f,  2.389893796e+01f,  -1.444575682e+01f,  2.333225353e+01f,  -1.369253436e+01f,  2.276556911e+01f,
            -1.584125837e+01f,  2.477883678e+01f,  -1.508881351e+01f,  2.420494660e+01f,  -1.433636866e+01f,  2.363105641e+01f,
            -1.358392380e+01f,  2.305716623e+01f,  -1.573031501e+01f,  2.509205118e+01f,  -1.497864775e+01f,  2.451095524e+01f,
            -1.422698050e+01f,  2.392985929e+01f,  -1.347531324e+01f,  2.334876335e+01f,  -2.098804421e+01f,  2.003345148e+01f,
            -2.009727274e+01f,  1.958440260e+01f,  -1.920650126e+01f,  1.913535372e+01f,  -1.831572979e+01f,  1.868630484e+01f,
            -2.470848403e+01f,  2.200357140e+01f,  -2.402049509e+01f,  2.117340175e+01f,  -2.333250614e+01f,  2.034323210e+01f,
            -2.264451720e+01f,  1.951306246e+01f,  -1.892043749e+01f,  2.800766982e+01f,  -1.841565823e+01f,  2.698850860e+01f,
            -1.791087898e+01f,  2.596934737e+01f,  -1.740609972e+01f,  2.495018615e+01f,  -1.880396453e+01f,  2.832779622e+01f,
            -1.830411007e+01f,  2.729728204e+01f,  -1.780425562e+01f,  2.626676785e+01f,  -1.730440116e+01f,  2.523625367e+01f,
            -1.868749157e+01f,  2.864792262e+01f,  -1.819256191e+01f,  2.760605548e+01f,  -1.769763226e+01f,  2.656418833e+01f,
            -1.720270260e+01f,  2.552232119e+01f,  -1.857101861e+01f,  2.896804902e+01f,  -1.808101375e+01f,  2.791482892e+01f,
            -1.759100890e+01f,  2.686160881e+01f,  -1.710100404e+01f,  2.580838871e+01f,  -2.399502998e+01f,  2.372019511e+01f,
            -2.327080488e+01f,  2.289411046e+01f,  -2.254657978e+01f,  2.206802580e+01f,  -2.182235467e+01f,  2.124194114e+01f,
            -1.947535430e+01f,  2.986153490e+01f,  -1.889276213e+01f,  2.884295191e+01f,  -1.831016995e+01f,  2.782436892e+01f,
            -1.772757778e+01f,  2.680578593e+01f,  -1.188898339e+01f,  3.765605383e+01f,  -1.152785774e+01f,  3.641055420e+01f,
            -1.116673210e+01f,  3.516505457e+01f,  -1.080560645e+01f,  3.391955494e+01f,  -1.168167763e+01f,  3.806657239e+01f,
            -1.132734302e+01f,  3.680787084e+01f,  -1.097300842e+01f,  3.554916929e+01f,  -1.061867381e+01f,  3.429046774e+01f,
            -1.147437187e+01f,  3.847709095e+01f,  -1.112682830e+01f,  3.720518748e+01f,  -1.077928474e+01f,  3.593328401e+01f,
            -1.043174117e+01f,  3.466138054e+01f,  -1.126706611e+01f,  3.888760951e+01f,  -1.092631358e+01f,  3.760250412e+01f,
            -1.058556106e+01f,  3.631739873e+01f,  -1.024480853e+01f,  3.503229334e+01f,  -1.876188816e+01f,  3.157025302e+01f,
            -1.813238078e+01f,  3.056651700e+01f,  -1.750287341e+01f,  2.956278098e+01f,  -1.687336603e+01f,  2.855904497e+01f,
            -1.924478464e+01f,  3.271590497e+01f,  -1.866003448e+01f,  3.161593807e+01f,  -1.807528432e+01f,  3.051597118e+01f,
            -1.749053416e+01f,  2.941600428e+01f,  -1.108821522e+01f,  4.107445230e+01f,  -1.074022402e+01f,  3.973245949e+01f,
            -1.039223283e+01f,  3.839046668e+01f,  -1.004424164e+01f,  3.704847388e+01f,  -1.086943250e+01f,  4.149616270e+01f,
            -1.052843970e+01f,  4.014076637e+01f,  -1.018744691e+01f,  3.878537004e+01f,  -9.846454120e+00f,  3.742997372e+01f,
            -1.065064978e+01f,  4.191787310e+01f,  -1.031665538e+01f,  4.054907325e+01f,  -9.982660992e+00f,  3.918027340e+01f,
            -9.648666600e+00f,  3.781147356e+01f,  -1.043186706e+01f,  4.233958350e+01f,  -1.010487106e+01f,  4.095738013e+01f,
            -9.777875072e+00f,  3.957517676e+01f,  -9.450879080e+00f,  3.819297340e+01f,  -1.871561603e+01f,  3.423602743e+01f,
            -1.807591202e+01f,  3.315897382e+01f,  -1.743620800e+01f,  3.208192020e+01f,  -1.679650398e+01f,  3.100486658e+01f,
            -1.985248202e+01f,  3.474790730e+01f,  -1.925034472e+01f,  3.358144697e+01f,  -1.864820742e+01f,  3.241498663e+01f,
            -1.804607013e+01f,  3.124852630e+01f,  -1.120057890e+01f,  4.360093470e+01f,  -1.084921810e+01f,  4.217852077e+01f,
            -1.049785731e+01f,  4.075610684e+01f,  -1.014649652e+01f,  3.933369292e+01f,  -1.098179618e+01f,  4.402264510e+01f,
            -1.063743378e+01f,  4.258682765e+01f,  -1.029307139e+01f,  4.115101020e+01f,  -9.948709000e+00f,  3.971519276e+01f,
            -1.076301346e+01f,  4.444435550e+01f,  -1.042564946e+01f,  4.299513453e+01f,  -1.008828547e+01f,  4.154591356e+01f,
            -9.750921480e+00f,  4.009669260e+01f,  -1.054423074e+01f,  4.486606590e+01f,  -1.021386514e+01f,  4.340344141e+01f,
            -9.883499552e+00f,  4.194081692e+01f,  -9.553133960e+00f,  4.047819244e+01f,  -1.932906419e+01f,  3.626084129e+01f,
            -1.866765995e+01f,  3.512160732e+01f,  -1.800625571e+01f,  3.398237335e+01f,  -1.734485147e+01f,  3.284313938e+01f,
            -2.046017939e+01f,  3.677990964e+01f,  -1.984065496e+01f,  3.554695586e+01f,  -1.922113053e+01f,  3.431400209e+01f,
            -1.860160610e+01f,  3.308104831e+01f,  -1.131294258e+01f,  4.612741710e+01f,  -1.095821218e+01f,  4.462458205e+01f,
            -1.060348179e+01f,  4.312174700e+01f,  -1.024875140e+01f,  4.161891196e+01f,  -1.109415986e+01f,  4.654912750e+01f,
            -1.074642786e+01f,  4.503288893e+01f,  -1.039869587e+01f,  4.351665036e+01f,  -1.005096388e+01f,  4.200041180e+01f,
            -1.087537714e+01f,  4.697083790e+01f,  -1.053464354e+01f,  4.544119581e+01f,  -1.019390995e+01f,  4.391155372e+01f,
            -9.853176360e+00f,  4.238191164e+01f,  -1.065659442e+01f,  4.739254830e+01f,  -1.032285922e+01f,  4.584950269e+01f,
            -9.989124032e+00f,  4.430645708e+01f,  -9.655388840e+00f,  4.276341148e+01f,  -1.994251235e+01f,  3.828565514e+01f,
            -1.925940789e+01f,  3.708424082e+01f,  -1.857630342e+01f,  3.588282650e+01f,  -1.789319896e+01f,  3.468141218e+01f,
            -2.230400467e+01f,  3.754623007e+01f,  -2.147452968e+01f,  3.643895230e+01f,  -2.064505469e+01f,  3.533167452e+01f,
            -1.981557970e+01f,  3.422439674e+01f,  -1.316624074e+01f,  4.687708769e+01f,  -1.257038357e+01f,  4.553108758e+01f,
            -1.197452640e+01f,  4.418508746e+01f,  -1.137866923e+01f,  4.283908735e+01f,  -1.296114682e+01f,  4.728484145e+01f,
            -1.237042181e+01f,  4.592729830e+01f,  -1.177969680e+01f,  4.456975514e+01f,  -1.118897179e+01f,  4.321221199e+01f,
            -1.275605290e+01f,  4.769259521e+01f,  -1.217046005e+01f,  4.632350902e+01f,  -1.158486720e+01f,  4.495442282e+01f,
            -1.099927435e+01f,  4.358533663e+01f,  -1.255095898e+01f,  4.810034897e+01f,  -1.197049829e+01f,  4.671971974e+01f,
            -1.139003760e+01f,  4.533909050e+01f,  -1.080957691e+01f,  4.395846127e+01f,  -2.217468547e+01f,  3.866328098e+01f,
            -2.127772517e+01f,  3.759142030e+01f,  -2.038076486e+01f,  3.651955961e+01f,  -1.948380456e+01f,  3.544769892e+01f,
            -3.230940902e+01f,  3.012701786e+01f,  -3.100176619e+01f,  2.941269334e+01f,  -2.969412336e+01f,  2.869836881e+01f,
            -2.838648053e+01f,  2.798404428e+01f,  -2.534875397e+01f,  3.727042278e+01f,  -2.418353311e+01f,  3.640830220e+01f,
            -2.301831226e+01f,  3.554618161e+01f,  -2.185309140e+01f,  3.468406103e+01f,  -2.523781061e+01f,  3.758363718e+01f,
            -2.407336735e+01f,  3.671431084e+01f,  -2.290892410e+01f,  3.584498449e+01f,  -2.174448084e+01f,  3.497565815e+01f,
            -2.512686725e+01f,  3.789685158e+01f,  -2.396320159e+01f,  3.702031948e+01f,  -2.279953594e+01f,  3.614378737e+01f,
            -2.163587028e+01f,  3.526725527e+01f,  -2.501592389e+01f,  3.821006598e+01f,  -2.385303583e+01f,  3.732632812e+01f,
            -2.269014778e+01f,  3.644259025e+01f,  -2.152725972e+01f,  3.555885239e+01f,  -3.302712605e+01f,  3.040096894e+01f,
            -3.165371899e+01f,  2.972025746e+01f,  -3.028031194e+01f,  2.903954599e+01f,  -2.890690488e+01f,  2.835883452e+01f,
        };

        float[] gw_expect = new float[] {
            6.345610776e+00f,  3.175314539e+02f,  2.922245064e+00f,  3.143601806e+02f,  -5.011206480e-01f,  3.111889074e+02f,
            6.360794280e+00f,  3.184632660e+02f,  2.927299608e+00f,  3.152828527e+02f,  -5.061950640e-01f,  3.121024395e+02f,
            6.375977784e+00f,  3.193950780e+02f,  2.932354152e+00f,  3.162055248e+02f,  -5.112694800e-01f,  3.130159716e+02f,
            6.391161288e+00f,  3.203268900e+02f,  2.937408696e+00f,  3.171281969e+02f,  -5.163438960e-01f,  3.139295037e+02f,
            -1.412399624e+02f,  1.714132777e+02f,  -1.432224720e+02f,  1.696830664e+02f,  -1.452049816e+02f,  1.679528552e+02f,
            -1.416564887e+02f,  1.719175956e+02f,  -1.436450003e+02f,  1.701823801e+02f,  -1.456335118e+02f,  1.684471645e+02f,
            -1.420730150e+02f,  1.724219136e+02f,  -1.440675285e+02f,  1.706816938e+02f,  -1.460620420e+02f,  1.689414739e+02f,
            -1.424895414e+02f,  1.729262316e+02f,  -1.444900568e+02f,  1.711810074e+02f,  -1.464905722e+02f,  1.694357833e+02f,
            -2.035444392e+00f,  3.106570892e+02f,  -5.460215544e+00f,  3.074844796e+02f,  -8.884986696e+00f,  3.043118700e+02f,
            -2.039441688e+00f,  3.115756924e+02f,  -5.474410920e+00f,  3.083938737e+02f,  -8.909380152e+00f,  3.052120550e+02f,
            -2.043438984e+00f,  3.124942956e+02f,  -5.488606296e+00f,  3.093032678e+02f,  -8.933773608e+00f,  3.061122401e+02f,
            -2.047436280e+00f,  3.134128988e+02f,  -5.502801672e+00f,  3.102126620e+02f,  -8.958167064e+00f,  3.070124251e+02f,
            -1.038032766e+02f,  2.176548359e+02f,  -1.063563681e+02f,  2.153540919e+02f,  -1.089094597e+02f,  2.130533480e+02f,
            -1.041177798e+02f,  2.182968720e+02f,  -1.066786075e+02f,  2.159893862e+02f,  -1.092394352e+02f,  2.136819003e+02f,
            -1.044322830e+02f,  2.189389081e+02f,  -1.070008468e+02f,  2.166246804e+02f,  -1.095694107e+02f,  2.143104527e+02f,
            -1.047467862e+02f,  2.195809442e+02f,  -1.073230862e+02f,  2.172599746e+02f,  -1.098993861e+02f,  2.149390050e+02f,
            -2.052863394e+02f,  1.174469817e+02f,  -2.067938590e+02f,  1.161918944e+02f,  -2.083013787e+02f,  1.149368070e+02f,
            -2.058996612e+02f,  1.177941486e+02f,  -2.074118723e+02f,  1.165353702e+02f,  -2.089240835e+02f,  1.152765919e+02f,
            -2.065129830e+02f,  1.181413154e+02f,  -2.080298856e+02f,  1.168788461e+02f,  -2.095467883e+02f,  1.156163767e+02f,
            -2.071263047e+02f,  1.184884823e+02f,  -2.086478989e+02f,  1.172223219e+02f,  -2.101694931e+02f,  1.159561616e+02f,
            -1.103175436e+02f,  2.126503985e+02f,  -1.128711382e+02f,  2.103492014e+02f,  -1.154247327e+02f,  2.080480044e+02f,
            -1.106481479e+02f,  2.132823266e+02f,  -1.132095286e+02f,  2.109743377e+02f,  -1.157709092e+02f,  2.086663488e+02f,
            -1.109787522e+02f,  2.139142547e+02f,  -1.135479189e+02f,  2.115994740e+02f,  -1.161170857e+02f,  2.092846933e+02f,
            -1.113093565e+02f,  2.145461828e+02f,  -1.138863093e+02f,  2.122246103e+02f,  -1.164632621e+02f,  2.099030378e+02f,
            -2.306277018e+01f,  3.076842595e+02f,  -2.667272910e+01f,  3.043267982e+02f,  -3.028268802e+01f,  3.009693369e+02f,
            -2.311267321e+01f,  3.086290863e+02f,  -2.673369584e+01f,  3.052615493e+02f,  -3.035471848e+01f,  3.018940122e+02f,
            -2.316257624e+01f,  3.095739131e+02f,  -2.679466259e+01f,  3.061963003e+02f,  -3.042674893e+01f,  3.028186874e+02f,
            -2.321247928e+01f,  3.105187399e+02f,  -2.685562933e+01f,  3.071310513e+02f,  -3.049877939e+01f,  3.037433627e+02f,
            -1.663709320e+02f,  1.659049683e+02f,  -1.684548263e+02f,  1.640735944e+02f,  -1.705387206e+02f,  1.622422205e+02f,
            -1.668593237e+02f,  1.664157587e+02f,  -1.689497308e+02f,  1.645788690e+02f,  -1.710401380e+02f,  1.627419793e+02f,
            -1.673477154e+02f,  1.669265490e+02f,  -1.694446353e+02f,  1.650841435e+02f,  -1.715415553e+02f,  1.632417381e+02f,
            -1.678361070e+02f,  1.674373393e+02f,  -1.699395399e+02f,  1.655894181e+02f,  -1.720429727e+02f,  1.637414968e+02f,
            -3.199703322e+01f,  3.002585198e+02f,  -3.560691918e+01f,  2.969012044e+02f,  -3.921680514e+01f,  2.935438890e+02f,
            -3.206836422e+01f,  3.011878863e+02f,  -3.568938685e+01f,  2.978204222e+02f,  -3.931040948e+01f,  2.944529581e+02f,
            -3.213969522e+01f,  3.021172529e+02f,  -3.577185452e+01f,  2.987396400e+02f,  -3.940401383e+01f,  2.953620272e+02f,
            -3.221102622e+01f,  3.030466195e+02f,  -3.585432220e+01f,  2.996588579e+02f,  -3.949761817e+01f,  2.962710963e+02f,
            -1.369606037e+02f,  2.041648168e+02f,  -1.395139441e+02f,  2.018641282e+02f,  -1.420672844e+02f,  1.995634395e+02f,
            -1.373638293e+02f,  2.047965264e+02f,  -1.399252100e+02f,  2.024887917e+02f,  -1.424865906e+02f,  2.001810571e+02f,
            -1.377670550e+02f,  2.054282360e+02f,  -1.403364759e+02f,  2.031134553e+02f,  -1.429058968e+02f,  2.007986746e+02f,
            -1.381702806e+02f,  2.060599456e+02f,  -1.407477418e+02f,  2.037381189e+02f,  -1.433252030e+02f,  2.014162922e+02f,
            -2.323399091e+02f,  1.100738563e+02f,  -2.338472629e+02f,  1.088191007e+02f,  -2.353546166e+02f,  1.075643451e+02f,
            -2.330376195e+02f,  1.104151341e+02f,  -2.345498307e+02f,  1.091565216e+02f,  -2.360620418e+02f,  1.078979092e+02f,
            -2.337353299e+02f,  1.107564120e+02f,  -2.352523985e+02f,  1.094939426e+02f,  -2.367694670e+02f,  1.082314732e+02f,
            -2.344330403e+02f,  1.110976898e+02f,  -2.359549662e+02f,  1.098313635e+02f,  -2.374768922e+02f,  1.085650373e+02f,
            -1.435745694e+02f,  1.990621737e+02f,  -1.461273069e+02f,  1.967621379e+02f,  -1.486800444e+02f,  1.944621020e+02f,
            -1.439948362e+02f,  1.996828353e+02f,  -1.465556639e+02f,  1.973757035e+02f,  -1.491164915e+02f,  1.950685717e+02f,
            -1.444151030e+02f,  2.003034968e+02f,  -1.469840208e+02f,  1.979892691e+02f,  -1.495529387e+02f,  1.956750414e+02f,
            -1.448353697e+02f,  2.009241583e+02f,  -1.474123778e+02f,  1.986028347e+02f,  -1.499893859e+02f,  1.962815110e+02f,
            -8.677952906e+01f,  2.637222286e+02f,  -9.020355833e+01f,  2.605511028e+02f,  -9.362758759e+01f,  2.573799769e+02f,
            -8.699933052e+01f,  2.645755940e+02f,  -9.043429975e+01f,  2.613945172e+02f,  -9.386926898e+01f,  2.582134404e+02f,
            -8.721913198e+01f,  2.654289595e+02f,  -9.066504118e+01f,  2.622379317e+02f,  -9.411095038e+01f,  2.590469040e+02f,
            -8.743893343e+01f,  2.662823249e+02f,  -9.089578260e+01f,  2.630813462e+02f,  -9.435263177e+01f,  2.598803675e+02f,
            -2.099880242e+02f,  1.420162756e+02f,  -2.119700915e+02f,  1.402869491e+02f,  -2.139521587e+02f,  1.385576225e+02f,
            -2.106049847e+02f,  1.424770203e+02f,  -2.125934963e+02f,  1.407422471e+02f,  -2.145820078e+02f,  1.390074739e+02f,
            -2.112219452e+02f,  1.429377650e+02f,  -2.132169011e+02f,  1.411975452e+02f,  -2.152118569e+02f,  1.394573253e+02f,
            -2.118389057e+02f,  1.433985097e+02f,  -2.138403059e+02f,  1.416528432e+02f,  -2.158417060e+02f,  1.399071767e+02f,
            -9.542607876e+01f,  2.565867192e+02f,  -9.884856434e+01f,  2.534172062e+02f,  -1.022710499e+02f,  2.502476932e+02f,
            -9.566793641e+01f,  2.574240005e+02f,  -9.910143108e+01f,  2.542444674e+02f,  -1.025349258e+02f,  2.510649343e+02f,
            -9.590979406e+01f,  2.582612817e+02f,  -9.935429782e+01f,  2.550717285e+02f,  -1.027988016e+02f,  2.518821753e+02f,
            -9.615165170e+01f,  2.590985629e+02f,  -9.960716455e+01f,  2.558989896e+02f,  -1.030626774e+02f,  2.526994164e+02f,
        };
    }
}

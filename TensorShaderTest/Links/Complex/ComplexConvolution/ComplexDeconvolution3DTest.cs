using System.Linq;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using TensorShader;
using static TensorShader.Field;

namespace TensorShaderTest.Links.ComplexConvolution {
    [TestClass]
    public class ComplexDeconvolution3DTest {
        [TestMethod]
        public void ReferenceTest() {
            int inchannels = 2, outchannels = 4, kwidth = 3, kheight = 5, kdepth = 7, stride = 2, inwidth = 13, inheight = 12, indepth = 11;
            int outwidth = (inwidth - kwidth) / stride + 1, outheight = (inheight - kheight) / stride + 1, outdepth = (indepth - kdepth) / stride + 1, batch = 3;

            float[] xval = (new float[inwidth * inheight * indepth * inchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] yval = (new float[outwidth * outheight * outdepth * outchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] wval = (new float[kwidth * kheight * kdepth * outchannels * inchannels / 2]).Select((_, idx) => idx * 1e-3f).Reverse().ToArray();

            Tensor xtensor = new Tensor(Shape.Map3D(inchannels, inwidth, inheight, indepth, batch), xval);
            Tensor ytensor = new Tensor(Shape.Map3D(outchannels, outwidth, outheight, outdepth, batch), yval);
            Tensor wtensor = new Tensor(Shape.Kernel3D(inchannels, outchannels / 2, kwidth, kheight, kdepth), wval);

            VariableField x_actual = xtensor;
            ParameterField w = wtensor;
            ParameterField y = ytensor;

            Field x_expect = ComplexDeconvolution3D(y, w, stride, Shape.Map3D(inchannels, inwidth, inheight, indepth, batch));
            Field err = x_expect - x_actual;

            (Flow flow, Parameters Parameters) = Flow.Optimize(err);

            flow.Execute();

            float[] gy_actual = y.GradTensor.State;
            float[] gw_actual = w.GradTensor.State;

            AssertError.Tolerance(gy_expect, gy_actual, 1e-7f, 1e-5f, $"not equal gy");

            AssertError.Tolerance(gw_expect, gw_actual, 1e-6f, 1e-4f, $"not equal gw"); /*backward tolerance*/
        }

        [TestMethod]
        public void TheoreticalTest() {
            int inchannels = 2, outchannels = 4, kwidth = 3, kheight = 5, kdepth = 7, stride = 2, inwidth = 13, inheight = 12, indepth = 11;
            int outwidth = (inwidth - kwidth) / stride + 1, outheight = (inheight - kheight) / stride + 1, outdepth = (indepth - kdepth) / stride + 1, batch = 3;

            float[] xval = (new float[inwidth * inheight * indepth * inchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] yval = (new float[outwidth * outheight * outdepth * outchannels * batch]).Select((_, idx) => idx * 1e-3f).ToArray();
            float[] wval = (new float[kwidth * kheight * kdepth * outchannels * inchannels / 2]).Select((_, idx) => idx * 1e-3f).Reverse().ToArray();

            Tensor xtensor = new Tensor(Shape.Map3D(inchannels, inwidth, inheight, indepth, batch), xval);
            Tensor ytensor = new Tensor(Shape.Map3D(outchannels, outwidth, outheight, outdepth, batch), yval);
            Tensor wtensor = new Tensor(Shape.Kernel3D(inchannels, outchannels / 2, kwidth, kheight, kdepth), wval);

            VariableField x_actual = xtensor;
            ParameterField w = wtensor;
            ParameterField y = ytensor;

            Field y_real = ComplexReal(y), y_imag = ComplexImag(y);
            Field w_real = ComplexReal(w), w_imag = ComplexImag(w);

            Field x_real = Deconvolution3D(y_real, w_real, stride, Shape.Map3D(inchannels / 2, inwidth, inheight, indepth, batch))
                         - Deconvolution3D(y_imag, w_imag, stride, Shape.Map3D(inchannels / 2, inwidth, inheight, indepth, batch));

            Field x_imag = Deconvolution3D(y_imag, w_real, stride, Shape.Map3D(inchannels / 2, inwidth, inheight, indepth, batch))
                         + Deconvolution3D(y_real, w_imag, stride, Shape.Map3D(inchannels / 2, inwidth, inheight, indepth, batch));

            Field x_expect = ComplexCast(x_real, x_imag);

            Field err = x_expect - x_actual;

            (Flow flow, Parameters Parameters) = Flow.Optimize(err);

            flow.Execute();

            float[] gy_actual = y.GradTensor.State;
            float[] gw_actual = w.GradTensor.State;

            AssertError.Tolerance(gy_expect, gy_actual, 1e-7f, 1e-5f, $"not equal gy");

            AssertError.Tolerance(gw_expect, gw_actual, 1e-6f, 1e-4f, $"not equal gw"); /*backward tolerance*/
        }

        float[] gy_expect = new float[] {
            -2.058765951e+01f,  7.354736472e+00f,  -2.028397628e+01f,  7.241863992e+00f,  -1.849065410e+01f,  9.663882630e+00f,
            -1.821715076e+01f,  9.518982930e+00f,  -1.813704470e+01f,  1.019497563e+01f,  -1.786749176e+01f,  1.004446713e+01f,
            -1.778343530e+01f,  1.072606863e+01f,  -1.751783276e+01f,  1.056995133e+01f,  -1.742982590e+01f,  1.125716163e+01f,
            -1.716817376e+01f,  1.109543553e+01f,  -1.948969527e+01f,  9.338212296e+00f,  -1.919706298e+01f,  9.205975272e+00f,
            -1.818386509e+01f,  1.210182367e+01f,  -1.791574904e+01f,  1.193140346e+01f,  -1.475833544e+01f,  1.575198576e+01f,
            -1.453580408e+01f,  1.553410560e+01f,  -1.422246344e+01f,  1.646556816e+01f,  -1.400562488e+01f,  1.624034400e+01f,
            -1.368659144e+01f,  1.717915056e+01f,  -1.347544568e+01f,  1.694658240e+01f,  -1.315071944e+01f,  1.789273296e+01f,
            -1.294526648e+01f,  1.765282080e+01f,  -1.640178723e+01f,  1.476987708e+01f,  -1.615055298e+01f,  1.457429028e+01f,
            -1.799179971e+01f,  1.458970639e+01f,  -1.772284693e+01f,  1.439839812e+01f,  -1.393797272e+01f,  1.886858976e+01f,
            -1.371965384e+01f,  1.862480112e+01f,  -1.339703192e+01f,  1.958712576e+01f,  -1.318429064e+01f,  1.933610832e+01f,
            -1.285609112e+01f,  2.030566176e+01f,  -1.264892744e+01f,  2.004741552e+01f,  -1.231515032e+01f,  2.102419776e+01f,
            -1.211356424e+01f,  2.075872272e+01f,  -1.618877389e+01f,  1.727806265e+01f,  -1.593610386e+01f,  1.706218682e+01f,
            -2.212691727e+01f,  1.270008415e+01f,  -2.180140940e+01f,  1.254376975e+01f,  -1.867850570e+01f,  1.636135503e+01f,
            -1.839364076e+01f,  1.616261373e+01f,  -1.831222430e+01f,  1.690483203e+01f,  -1.803102176e+01f,  1.670076993e+01f,
            -1.794594290e+01f,  1.744830903e+01f,  -1.766840276e+01f,  1.723892613e+01f,  -1.757966150e+01f,  1.799178603e+01f,
            -1.730578376e+01f,  1.777708233e+01f,  -2.097962439e+01f,  1.473134494e+01f,  -2.066373898e+01f,  1.455709447e+01f,
            -4.141976948e+01f,  1.404959983e+01f,  -4.087758951e+01f,  1.391338409e+01f,  -3.756942782e+01f,  1.811307518e+01f,
            -3.706286281e+01f,  1.793946003e+01f,  -3.710698250e+01f,  1.875207146e+01f,  -3.660404149e+01f,  1.857317679e+01f,
            -3.664453718e+01f,  1.939106774e+01f,  -3.614522017e+01f,  1.920689355e+01f,  -3.618209186e+01f,  2.003006402e+01f,
            -3.568639885e+01f,  1.984061031e+01f,  -3.995988418e+01f,  1.639090577e+01f,  -3.942722031e+01f,  1.623687185e+01f,
            -3.642127059e+01f,  2.138835257e+01f,  -3.592018827e+01f,  2.118915348e+01f,  -3.058231237e+01f,  2.745176098e+01f,
            -3.013345131e+01f,  2.719855291e+01f,  -2.990730085e+01f,  2.830322146e+01f,  -2.946367947e+01f,  2.804312635e+01f,
            -2.923228933e+01f,  2.915468194e+01f,  -2.879390763e+01f,  2.888769979e+01f,  -2.855727781e+01f,  3.000614242e+01f,
            -2.812413579e+01f,  2.973227323e+01f,  -3.418762064e+01f,  2.450242927e+01f,  -3.370128661e+01f,  2.428021246e+01f,
            -3.588551600e+01f,  2.421386038e+01f,  -3.538113320e+01f,  2.399625233e+01f,  -2.934247803e+01f,  3.098022571e+01f,
            -2.889472290e+01f,  3.070423493e+01f,  -2.866746651e+01f,  3.183155563e+01f,  -2.822482050e+01f,  3.154880837e+01f,
            -2.799245499e+01f,  3.268288555e+01f,  -2.755491810e+01f,  3.239338181e+01f,  -2.731744347e+01f,  3.353421547e+01f,
            -2.688501570e+01f,  3.323795525e+01f,  -3.365933408e+01f,  2.731973791e+01f,  -3.316902066e+01f,  2.707979105e+01f,
            -4.226702967e+01f,  2.007330310e+01f,  -4.169741406e+01f,  1.989929023e+01f,  -3.691571990e+01f,  2.563498358e+01f,
            -3.639071809e+01f,  2.541464427e+01f,  -3.645327458e+01f,  2.627365346e+01f,  -3.593157037e+01f,  2.604836103e+01f,
            -3.599082926e+01f,  2.691232334e+01f,  -3.547242265e+01f,  2.668207779e+01f,  -3.552838394e+01f,  2.755099322e+01f,
            -3.501327493e+01f,  2.731579455e+01f,  -4.082581446e+01f,  2.239418945e+01f,  -4.026409599e+01f,  2.220397735e+01f,
            -6.671128345e+01f,  1.622970761e+01f,  -6.588926012e+01f,  1.611161657e+01f,  -6.239371970e+01f,  2.074768359e+01f,
            -6.160162916e+01f,  2.059796277e+01f,  -6.202743830e+01f,  2.128954779e+01f,  -6.123739736e+01f,  2.113611897e+01f,
            -6.166115690e+01f,  2.183141199e+01f,  -6.087316556e+01f,  2.167427517e+01f,  -6.129487550e+01f,  2.237327619e+01f,
            -6.050893376e+01f,  2.221243137e+01f,  -6.565624273e+01f,  1.816221434e+01f,  -6.483798510e+01f,  1.803204401e+01f,
            -6.148803123e+01f,  2.377234169e+01f,  -6.069470456e+01f,  2.360377390e+01f,  -5.517046088e+01f,  3.029611248e+01f,
            -5.442018680e+01f,  3.008281728e+01f,  -5.462952008e+01f,  3.101222928e+01f,  -5.388240440e+01f,  3.079412448e+01f,
            -5.408857928e+01f,  3.172834608e+01f,  -5.334462200e+01f,  3.150543168e+01f,  -5.354763848e+01f,  3.244446288e+01f,
            -5.280683960e+01f,  3.221673888e+01f,  -5.982338365e+01f,  2.631223740e+01f,  -5.903722510e+01f,  2.612821668e+01f,
            -6.155836381e+01f,  2.598650921e+01f,  -6.075491067e+01f,  2.580634308e+01f,  -5.469731096e+01f,  3.305135712e+01f,
            -5.393963720e+01f,  3.282376560e+01f,  -5.416143896e+01f,  3.376228992e+01f,  -5.340680840e+01f,  3.353000400e+01f,
            -5.362556696e+01f,  3.447322272e+01f,  -5.287397960e+01f,  3.423624240e+01f,  -5.308969496e+01f,  3.518415552e+01f,
            -5.234115080e+01f,  3.494248080e+01f,  -5.992784307e+01f,  2.849163295e+01f,  -5.913095902e+01f,  2.829661294e+01f,
            -6.890957737e+01f,  2.089076729e+01f,  -6.804554636e+01f,  2.074941737e+01f,  -6.344960330e+01f,  2.654555919e+01f,
            -6.262092236e+01f,  2.636722557e+01f,  -6.309599390e+01f,  2.707446339e+01f,  -6.226907456e+01f,  2.689270977e+01f,
            -6.274238450e+01f,  2.760336759e+01f,  -6.191722676e+01f,  2.741819397e+01f,  -6.238877510e+01f,  2.813227179e+01f,
            -6.156537896e+01f,  2.794367817e+01f,  -6.793681249e+01f,  2.273945450e+01f,  -6.707511870e+01f,  2.258745377e+01f,
            -1.418070352e+02f,  3.755022031e+01f,  -1.403874672e+02f,  3.711303679e+01f,  -1.320112973e+02f,  4.757245863e+01f,
            -1.307017428e+02f,  4.702372533e+01f,  -1.316576879e+02f,  4.810355163e+01f,  -1.303520838e+02f,  4.754920953e+01f,
            -1.313040785e+02f,  4.863464463e+01f,  -1.300024248e+02f,  4.807469373e+01f,  -1.309504691e+02f,  4.916573763e+01f,
            -1.296527658e+02f,  4.860017793e+01f,  -1.405829961e+02f,  3.965728270e+01f,  -1.391719907e+02f,  3.920322295e+01f,
            -1.289173566e+02f,  5.279667007e+01f,  -1.276341327e+02f,  5.220157658e+01f,  -1.151560714e+02f,  6.679979856e+01f,
            -1.140229417e+02f,  6.605315040e+01f,  -1.146201994e+02f,  6.751338096e+01f,  -1.134927625e+02f,  6.675938880e+01f,
            -1.140843274e+02f,  6.822696336e+01f,  -1.129625833e+02f,  6.746562720e+01f,  -1.135484554e+02f,  6.894054576e+01f,
            -1.124324041e+02f,  6.817186560e+01f,  -1.269826618e+02f,  5.561402268e+01f,  -1.257130019e+02f,  5.499708036e+01f,
            -1.284266928e+02f,  5.557651567e+01f,  -1.271359967e+02f,  5.496716964e+01f,  -1.139707551e+02f,  7.027306176e+01f,
            -1.128335434e+02f,  6.950879952e+01f,  -1.134298143e+02f,  7.099159776e+01f,  -1.122981802e+02f,  7.022010672e+01f,
            -1.128888735e+02f,  7.171013376e+01f,  -1.117628170e+02f,  7.093141392e+01f,  -1.123479327e+02f,  7.242866976e+01f,
            -1.112274538e+02f,  7.164272112e+01f,  -1.264843211e+02f,  5.840090009e+01f,  -1.252065899e+02f,  5.777030426e+01f,
            -1.425997970e+02f,  4.362547519e+01f,  -1.411418155e+02f,  4.316143855e+01f,  -1.312867649e+02f,  5.516157903e+01f,
            -1.299451128e+02f,  5.457974013e+01f,  -1.309204835e+02f,  5.570505603e+01f,  -1.295824938e+02f,  5.511789633e+01f,
            -1.305542021e+02f,  5.624853303e+01f,  -1.292198748e+02f,  5.565605253e+01f,  -1.301879207e+02f,  5.679201003e+01f,
            -1.288572558e+02f,  5.619420873e+01f,  -1.413596068e+02f,  4.574714494e+01f,  -1.399087595e+02f,  4.526766055e+01f,
            -1.563162273e+02f,  5.051444738e+01f,  -1.546395278e+02f,  5.007272124e+01f,  -1.432538848e+02f,  6.379068734e+01f,
            -1.416877678e+02f,  6.323694675e+01f,  -1.427914395e+02f,  6.442968362e+01f,  -1.412289464e+02f,  6.387066351e+01f,
            -1.423289941e+02f,  6.506867990e+01f,  -1.407701251e+02f,  6.450438027e+01f,  -1.418665488e+02f,  6.570767618e+01f,
            -1.403113038e+02f,  6.513809703e+01f,  -1.548375413e+02f,  5.287173386e+01f,  -1.531675378e+02f,  5.241500964e+01f,
            -1.390673350e+02f,  7.009818828e+01f,  -1.375252664e+02f,  6.950041562e+01f,  -1.209620029e+02f,  8.842679554e+01f,
            -1.195699188e+02f,  8.767772059e+01f,  -1.202869914e+02f,  8.927825602e+01f,  -1.189001470e+02f,  8.852229403e+01f,
            -1.196119799e+02f,  9.012971650e+01f,  -1.182303752e+02f,  8.936686747e+01f,  -1.189369684e+02f,  9.098117698e+01f,
            -1.175606033e+02f,  9.021144091e+01f,  -1.368261648e+02f,  7.321602511e+01f,  -1.352950843e+02f,  7.259899486e+01f,
            -1.385240602e+02f,  7.292369609e+01f,  -1.369711708e+02f,  7.231503473e+01f,  -1.197221686e+02f,  9.194585995e+01f,
            -1.183217901e+02f,  9.118340261e+01f,  -1.190471571e+02f,  9.279718987e+01f,  -1.176518877e+02f,  9.202797605e+01f,
            -1.183721456e+02f,  9.364851979e+01f,  -1.169819853e+02f,  9.287254949e+01f,  -1.176971340e+02f,  9.449984971e+01f,
            -1.163120829e+02f,  9.371712293e+01f,  -1.363053985e+02f,  7.601829324e+01f,  -1.347628184e+02f,  7.539105319e+01f,
            -1.571446868e+02f,  5.653815065e+01f,  -1.554217510e+02f,  5.607742802e+01f,  -1.426001769e+02f,  7.128909494e+01f,
            -1.409921222e+02f,  7.071213099e+01f,  -1.421377315e+02f,  7.192776482e+01f,  -1.405329745e+02f,  7.134584775e+01f,
            -1.416752862e+02f,  7.256643470e+01f,  -1.400738268e+02f,  7.197956451e+01f,  -1.412128409e+02f,  7.320510458e+01f,
            -1.396146791e+02f,  7.261328127e+01f,  -1.557222722e+02f,  5.883741626e+01f,  -1.540044135e+02f,  5.836331450e+01f,
            -1.870912658e+02f,  4.715509865e+01f,  -1.850438716e+02f,  4.682218265e+01f,  -1.750019789e+02f,  5.943178599e+01f,
            -1.730369796e+02f,  5.901508917e+01f,  -1.746356975e+02f,  5.997365019e+01f,  -1.726727478e+02f,  5.955324537e+01f,
            -1.742694161e+02f,  6.051551439e+01f,  -1.723085160e+02f,  6.009140157e+01f,  -1.739031347e+02f,  6.105737859e+01f,
            -1.719442842e+02f,  6.062955777e+01f,  -1.861291224e+02f,  4.899221978e+01f,  -1.840830056e+02f,  4.864971281e+01f,
            -1.717835784e+02f,  6.475915097e+01f,  -1.698291625e+02f,  6.431189134e+01f,  -1.552032433e+02f,  8.152640208e+01f,
            -1.533598940e+02f,  8.096681568e+01f,  -1.546623025e+02f,  8.224251888e+01f,  -1.528221116e+02f,  8.167812288e+01f,
            -1.541213617e+02f,  8.295863568e+01f,  -1.522843292e+02f,  8.238943008e+01f,  -1.535804209e+02f,  8.367475248e+01f,
            -1.517465468e+02f,  8.310073728e+01f,  -1.702582768e+02f,  6.715638300e+01f,  -1.683077112e+02f,  6.669698820e+01f,
            -1.721392384e+02f,  6.668135561e+01f,  -1.701680604e+02f,  6.622913316e+01f,  -1.550950470e+02f,  8.390839872e+01f,
            -1.532360036e+02f,  8.334281040e+01f,  -1.545591750e+02f,  8.461933152e+01f,  -1.527031748e+02f,  8.404904880e+01f,
            -1.540233030e+02f,  8.533026432e+01f,  -1.521703460e+02f,  8.475528720e+01f,  -1.534874310e+02f,  8.604119712e+01f,
            -1.516375172e+02f,  8.546152560e+01f,  -1.706613346e+02f,  6.903054463e+01f,  -1.686934080e+02f,  6.856678606e+01f,
            -1.900028782e+02f,  5.108625113e+01f,  -1.878968875e+02f,  5.074666505e+01f,  -1.769702465e+02f,  6.429654159e+01f,
            -1.749479208e+02f,  6.387196797e+01f,  -1.766166371e+02f,  6.482544579e+01f,  -1.745960730e+02f,  6.439745217e+01f,
            -1.762630277e+02f,  6.535434999e+01f,  -1.742442252e+02f,  6.492293637e+01f,  -1.759094183e+02f,  6.588325419e+01f,
            -1.738923774e+02f,  6.544842057e+01f,  -1.891561882e+02f,  5.280637514e+01f,  -1.870500464e+02f,  5.245862657e+01f,
            -2.630264109e+02f,  6.774570415e+01f,  -2.604909580e+02f,  6.698420959e+01f,  -2.455319405e+02f,  8.548103463e+01f,
            -2.431863348e+02f,  8.452846773e+01f,  -2.451783311e+02f,  8.601212763e+01f,  -2.428366758e+02f,  8.505395193e+01f,
            -2.448247217e+02f,  8.654322063e+01f,  -2.424870168e+02f,  8.557943613e+01f,  -2.444711123e+02f,  8.707431363e+01f,
            -2.421373578e+02f,  8.610492033e+01f,  -2.616762969e+02f,  6.997635310e+01f,  -2.591469183e+02f,  6.920047063e+01f,
            -2.396508481e+02f,  9.349151647e+01f,  -2.373525164e+02f,  9.247174970e+01f,  -2.155538074e+02f,  1.178476114e+02f,
            -2.135100793e+02f,  1.165721952e+02f,  -2.150179354e+02f,  1.185611938e+02f,  -2.129799001e+02f,  1.172784336e+02f,
            -2.144820634e+02f,  1.192747762e+02f,  -2.124497209e+02f,  1.179846720e+02f,  -2.139461914e+02f,  1.199883586e+02f,
            -2.119195417e+02f,  1.186909104e+02f,  -2.375635364e+02f,  9.645816828e+01f,  -2.352754509e+02f,  9.541987044e+01f,
            -2.388615860e+02f,  9.656332495e+01f,  -2.365491464e+02f,  9.553594116e+01f,  -2.140035375e+02f,  1.216775338e+02f,
            -2.119474330e+02f,  1.203927979e+02f,  -2.134625967e+02f,  1.223960698e+02f,  -2.114120698e+02f,  1.211041051e+02f,
            -2.129216559e+02f,  1.231146058e+02f,  -2.108767066e+02f,  1.218154123e+02f,  -2.123807151e+02f,  1.238331418e+02f,
            -2.103413434e+02f,  1.225267195e+02f,  -2.367798683e+02f,  9.952373753e+01f,  -2.344770760e+02f,  9.847842170e+01f,
            -2.630726766e+02f,  7.455086623e+01f,  -2.604822216e+02f,  7.377910735e+01f,  -2.438950241e+02f,  9.396180303e+01f,
            -2.414965848e+02f,  9.299686653e+01f,  -2.435287427e+02f,  9.450528003e+01f,  -2.411339658e+02f,  9.353502273e+01f,
            -2.431624613e+02f,  9.504875703e+01f,  -2.407713468e+02f,  9.407317893e+01f,  -2.427961799e+02f,  9.559223403e+01f,
            -2.404087278e+02f,  9.461133513e+01f,  -2.617395892e+02f,  7.676294494e+01f,  -2.591537799e+02f,  7.597822663e+01f,
            -2.712126851e+02f,  8.697929494e+01f,  -2.684014660e+02f,  8.623205839e+01f,  -2.489383417e+02f,  1.094682995e+02f,
            -2.463126727e+02f,  1.085344335e+02f,  -2.484758964e+02f,  1.101072958e+02f,  -2.458538514e+02f,  1.091681502e+02f,
            -2.480134511e+02f,  1.107462921e+02f,  -2.453950301e+02f,  1.098018670e+02f,  -2.475510058e+02f,  1.113852883e+02f,
            -2.449362088e+02f,  1.104355837e+02f,  -2.697151985e+02f,  8.935256196e+01f,  -2.669078553e+02f,  8.859314743e+01f,
            -2.417133995e+02f,  1.188080240e+02f,  -2.391303444e+02f,  1.178116778e+02f,  -2.113416935e+02f,  1.494018301e+02f,
            -2.090063864e+02f,  1.481568883e+02f,  -2.106666820e+02f,  1.502532906e+02f,  -2.083366145e+02f,  1.490014617e+02f,
            -2.099916704e+02f,  1.511047511e+02f,  -2.076668427e+02f,  1.498460352e+02f,  -2.093166589e+02f,  1.519562115e+02f,
            -2.069970708e+02f,  1.506906086e+02f,  -2.394647090e+02f,  1.219296210e+02f,  -2.368888820e+02f,  1.209177773e+02f,
            -2.411626044e+02f,  1.216335318e+02f,  -2.385612083e+02f,  1.206338171e+02f,  -2.101018592e+02f,  1.529114942e+02f,
            -2.077488573e+02f,  1.516625703e+02f,  -2.094268476e+02f,  1.537628241e+02f,  -2.070789549e+02f,  1.525071437e+02f,
            -2.087518361e+02f,  1.546141540e+02f,  -2.064090525e+02f,  1.533517172e+02f,  -2.080768246e+02f,  1.554654840e+02f,
            -2.057391501e+02f,  1.541962906e+02f,  -2.389514630e+02f,  1.247168486e+02f,  -2.363566160e+02f,  1.237023153e+02f,
            -2.720223440e+02f,  9.300299820e+01f,  -2.691460880e+02f,  9.225556582e+01f,  -2.482846338e+02f,  1.169432063e+02f,
            -2.455935264e+02f,  1.160096177e+02f,  -2.478221885e+02f,  1.175818762e+02f,  -2.451343787e+02f,  1.166433345e+02f,
            -2.473597432e+02f,  1.182205461e+02f,  -2.446752310e+02f,  1.172770512e+02f,  -2.468972979e+02f,  1.188592159e+02f,
            -2.442160832e+02f,  1.179107680e+02f,  -2.706187300e+02f,  9.528064308e+01f,  -2.677447310e+02f,  9.452265166e+01f,
            -3.074712482e+02f,  7.808048969e+01f,  -3.041984832e+02f,  7.753274873e+01f,  -2.876102381e+02f,  9.811588839e+01f,
            -2.844723300e+02f,  9.743221557e+01f,  -2.872439567e+02f,  9.865775259e+01f,  -2.841080982e+02f,  9.797037177e+01f,
            -2.868776753e+02f,  9.919961679e+01f,  -2.837438664e+02f,  9.850852797e+01f,  -2.865113939e+02f,  9.974148099e+01f,
            -2.833796346e+02f,  9.904668417e+01f,  -3.066020021e+02f,  7.982222522e+01f,  -3.033280261e+02f,  7.926738161e+01f,
            -2.820791256e+02f,  1.057459602e+02f,  -2.789636204e+02f,  1.050200088e+02f,  -2.552360257e+02f,  1.327566917e+02f,
            -2.522996012e+02f,  1.318508141e+02f,  -2.546950849e+02f,  1.334728085e+02f,  -2.517618188e+02f,  1.325621213e+02f,
            -2.541541441e+02f,  1.341889253e+02f,  -2.512240364e+02f,  1.332734285e+02f,  -2.536132033e+02f,  1.349050421e+02f,
            -2.506862540e+02f,  1.339847357e+02f,  -2.806931699e+02f,  1.080005286e+02f,  -2.775781973e+02f,  1.072657597e+02f,
            -2.827201129e+02f,  1.073762020e+02f,  -2.795812102e+02f,  1.066519232e+02f,  -2.554927830e+02f,  1.347654403e+02f,
            -2.525323700e+02f,  1.338618552e+02f,  -2.549569110e+02f,  1.354763731e+02f,  -2.519995412e+02f,  1.345680936e+02f,
            -2.544210390e+02f,  1.361873059e+02f,  -2.514667124e+02f,  1.352743320e+02f,  -2.538851670e+02f,  1.368982387e+02f,
            -2.509338836e+02f,  1.359805704e+02f,  -2.813948261e+02f,  1.095694563e+02f,  -2.782558569e+02f,  1.088369592e+02f,
            -3.110961790e+02f,  8.128173497e+01f,  -3.077482286e+02f,  8.074391273e+01f,  -2.904908897e+02f,  1.020475240e+02f,
            -2.872749192e+02f,  1.013767104e+02f,  -2.901372803e+02f,  1.025764282e+02f,  -2.869230714e+02f,  1.019021946e+02f,
            -2.897836709e+02f,  1.031053324e+02f,  -2.865712236e+02f,  1.024276788e+02f,  -2.894300615e+02f,  1.036342366e+02f,
            -2.862193758e+02f,  1.029531630e+02f,  -3.103755638e+02f,  8.287329578e+01f,  -3.070249741e+02f,  8.232979937e+01f,
        };

        float[] gw_expect = new float[] {
            -5.241125697e+02f,  5.484897491e+02f,  -5.258955816e+02f,  5.502860973e+02f,  -7.744203906e+02f,  2.992733983e+02f,
            -7.770212298e+02f,  3.002541173e+02f,  -5.258630000e+02f,  5.474744446e+02f,  -5.276453346e+02f,  5.492748899e+02f,
            -6.552475969e+02f,  4.225309203e+02f,  -6.574548808e+02f,  4.239256086e+02f,  -8.480954774e+02f,  2.306227810e+02f,
            -8.509382219e+02f,  2.313841416e+02f,  -6.568034711e+02f,  4.217125058e+02f,  -6.590111030e+02f,  4.231102740e+02f,
            -4.817037905e+02f,  6.003490288e+02f,  -4.833190078e+02f,  6.023577501e+02f,  -7.557390603e+02f,  3.275103007e+02f,
            -7.582687461e+02f,  3.286069093e+02f,  -4.836597684e+02f,  5.991276352e+02f,  -4.852741102e+02f,  6.011406477e+02f,
            -6.687707876e+02f,  4.186494461e+02f,  -6.710027369e+02f,  4.200642449e+02f,  -8.598862798e+02f,  2.284920965e+02f,
            -8.627629414e+02f,  2.292643850e+02f,  -6.703958094e+02f,  4.177622434e+02f,  -6.726282588e+02f,  4.191799699e+02f,
            -5.601743572e+02f,  5.316959184e+02f,  -5.620251690e+02f,  5.335139047e+02f,  -8.029268818e+02f,  2.900787656e+02f,
            -8.056056745e+02f,  2.910711590e+02f,  -5.620898184e+02f,  5.305165368e+02f,  -5.639404228e+02f,  5.323381502e+02f,
            -6.857482058e+02f,  4.449103122e+02f,  -6.881333134e+02f,  4.463732774e+02f,  -8.889795719e+02f,  2.427870698e+02f,
            -8.920317820e+02f,  2.435855194e+02f,  -6.875629177e+02f,  4.438322813e+02f,  -6.899489031e+02f,  4.452977884e+02f,
            -7.940202335e+02f,  3.418252052e+02f,  -7.967585059e+02f,  3.429578077e+02f,  -9.501782136e+02f,  1.866186518e+02f,
            -9.534334489e+02f,  1.872367268e+02f,  -7.956210357e+02f,  3.409630723e+02f,  -7.983608656e+02f,  3.420975451e+02f,
            -6.552045161e+02f,  4.849094056e+02f,  -6.574676470e+02f,  4.865388309e+02f,  -8.767678779e+02f,  2.645570575e+02f,
            -8.797739733e+02f,  2.654463061e+02f,  -6.572157900e+02f,  4.836344440e+02f,  -6.594797734e+02f,  4.852664325e+02f,
            -8.077686171e+02f,  3.377253809e+02f,  -8.105383978e+02f,  3.388712510e+02f,  -9.620884553e+02f,  1.843722605e+02f,
            -9.653813403e+02f,  1.849975308e+02f,  -8.094261253e+02f,  3.368069014e+02f,  -8.121976156e+02f,  3.379544897e+02f,
            -7.223354435e+02f,  4.276069980e+02f,  -7.248043177e+02f,  4.290756345e+02f,  -9.177647549e+02f,  2.333224544e+02f,
            -9.209036276e+02f,  2.341238692e+02f,  -7.242861559e+02f,  4.263939204e+02f,  -7.267563779e+02f,  4.278646288e+02f,
            -6.195387385e+02f,  5.685274999e+02f,  -6.216436513e+02f,  5.705390206e+02f,  -8.794055684e+02f,  3.100794077e+02f,
            -8.824274205e+02f,  3.111771214e+02f,  -6.219702039e+02f,  5.668313331e+02f,  -6.240757572e+02f,  5.688456209e+02f,
            -7.573261866e+02f,  4.360769930e+02f,  -7.599098155e+02f,  4.376328392e+02f,  -9.566678612e+02f,  2.379292694e+02f,
            -9.599612432e+02f,  2.387782353e+02f,  -7.594107287e+02f,  4.347301088e+02f,  -7.619957661e+02f,  4.362879648e+02f,
            -5.797515459e+02f,  6.176868447e+02f,  -5.816762570e+02f,  6.199228389e+02f,  -8.621744936e+02f,  3.368233724e+02f,
            -8.651184895e+02f,  3.380435109e+02f,  -5.824634153e+02f,  6.157099283e+02f,  -5.843888023e+02f,  6.179486488e+02f,
            -7.735405670e+02f,  4.295056060e+02f,  -7.761537654e+02f,  4.310766079e+02f,  -9.699264412e+02f,  2.343315366e+02f,
            -9.732564291e+02f,  2.351887139e+02f,  -7.756938973e+02f,  4.280904128e+02f,  -7.783087070e+02f,  4.296632218e+02f,
            -6.644423714e+02f,  5.428958086e+02f,  -6.666366241e+02f,  5.449072879e+02f,  -9.127340942e+02f,  2.960650005e+02f,
            -9.158456917e+02f,  2.971625207e+02f,  -6.670361858e+02f,  5.410385646e+02f,  -6.692317057e+02f,  5.430521843e+02f,
            -8.091311236e+02f,  4.372824876e+02f,  -8.119534621e+02f,  4.388458420e+02f,  -1.009150863e+03f,  2.385660731e+02f,
            -1.012686948e+03f,  2.394189558e+02f,  -8.113956871e+02f,  4.357558217e+02f,  -8.142200704e+02f,  4.373205449e+02f,
            -9.170019902e+02f,  3.346967383e+02f,  -9.202046515e+02f,  3.359028944e+02f,  -1.070102518e+03f,  1.826981388e+02f,
            -1.073856374e+03f,  1.833560764e+02f,  -9.189487570e+02f,  3.334896188e+02f,  -9.221539013e+02f,  3.346967150e+02f,
            -7.824875693e+02f,  4.733416844e+02f,  -7.851859793e+02f,  4.750732434e+02f,  -9.990774976e+02f,  2.581761054e+02f,
            -1.002566450e+03f,  2.591206908e+02f,  -7.849893164e+02f,  4.715776897e+02f,  -7.876899190e+02f,  4.733104650e+02f,
            -9.325385993e+02f,  3.288141170e+02f,  -9.357772739e+02f,  3.300290104e+02f,  -1.082986523e+03f,  1.794809619e+02f,
            -1.086780493e+03f,  1.801436170e+02f,  -9.345361694e+02f,  3.275566136e+02f,  -9.377775043e+02f,  3.287722697e+02f,
            -8.512221318e+02f,  4.144900928e+02f,  -8.541453175e+02f,  4.160419680e+02f,  -1.040933312e+03f,  2.261122481e+02f,
            -1.044565397e+03f,  2.269587199e+02f,  -8.536052361e+02f,  4.128459988e+02f,  -8.565310149e+02f,  4.143986946e+02f,
            -8.788780689e+02f,  4.252582509e+02f,  -8.819035841e+02f,  4.268867086e+02f,  -1.073669509e+03f,  2.319381245e+02f,
            -1.077439226e+03f,  2.328262387e+02f,  -8.815105905e+02f,  4.233642627e+02f,  -8.845391516e+02f,  4.249930821e+02f,
            -9.852102986e+02f,  3.242947230e+02f,  -9.886347608e+02f,  3.255476300e+02f,  -1.133759065e+03f,  1.769778515e+02f,
            -1.137756655e+03f,  1.776610675e+02f,  -9.874410433e+02f,  3.228041521e+02f,  -9.908687849e+02f,  3.240571981e+02f,
            -8.561242452e+02f,  4.573908520e+02f,  -8.590264743e+02f,  4.591866900e+02f,  -1.065727505e+03f,  2.493967308e+02f,
            -1.069450483e+03f,  2.503760552e+02f,  -8.590296506e+02f,  4.552239938e+02f,  -8.619352283e+02f,  4.570198856e+02f,
            -1.002201809e+03f,  3.169601959e+02f,  -1.005666181e+03f,  3.182179183e+02f,  -1.147435682e+03f,  1.729697117e+02f,
            -1.151475519e+03f,  1.736554990e+02f,  -1.004479887e+03f,  3.154227708e+02f,  -1.007947741e+03f,  3.166804295e+02f,
            -9.255968483e+02f,  3.978460837e+02f,  -9.287378584e+02f,  3.994483450e+02f,  -1.107973456e+03f,  2.169672071e+02f,
            -1.111847185e+03f,  2.178408614e+02f,  -9.283379712e+02f,  3.958447660e+02f,  -9.314826539e+02f,  3.974467622e+02f,
            -1.061525457e+03f,  3.012843349e+02f,  -1.065271904e+03f,  3.024621801e+02f,  -1.199553313e+03f,  1.644641392e+02f,
            -1.203838941e+03f,  1.651063224e+02f,  -1.063722928e+03f,  2.998279411e+02f,  -1.067472989e+03f,  3.010055910e+02f,
            -1.138546272e+03f,  2.295077759e+02f,  -1.142589265e+03f,  2.304123331e+02f,  -1.243678750e+03f,  1.253999330e+02f,
            -1.248136355e+03f,  1.258930390e+02f,  -1.140431185e+03f,  2.283649512e+02f,  -1.144477864e+03f,  2.292692499e+02f,
            -1.049078718e+03f,  3.231891354e+02f,  -1.052751874e+03f,  3.244845267e+02f,  -1.197213951e+03f,  1.763633773e+02f,
            -1.201480104e+03f,  1.770695963e+02f,  -1.051477064e+03f,  3.215319863e+02f,  -1.055154113e+03f,  3.228268995e+02f,
            -1.153840621e+03f,  2.238808419e+02f,  -1.157926679e+03f,  2.247871099e+02f,  -1.256425067e+03f,  1.223277512e+02f,
            -1.260926626e+03f,  1.228217488e+02f,  -1.155755919e+03f,  2.227079916e+02f,  -1.159845816e+03f,  2.236138489e+02f,
            -1.101723634e+03f,  2.804181336e+02f,  -1.105584868e+03f,  2.815706290e+02f,  -1.230289338e+03f,  1.530748912e+02f,
            -1.234678550e+03f,  1.537031190e+02f,  -1.103988317e+03f,  2.788954813e+02f,  -1.107853636e+03f,  2.800473115e+02f,
            -1.223721794e+03f,  1.971989397e+02f,  -1.228125080e+03f,  1.979886588e+02f,  -1.314391186e+03f,  1.077289788e+02f,
            -1.319158045e+03f,  1.081590326e+02f,  -1.225884014e+03f,  1.957793522e+02f,  -1.230292470e+03f,  1.965673209e+02f,
            -1.277576588e+03f,  1.485869593e+02f,  -1.282193147e+03f,  1.491868529e+02f,  -1.345880925e+03f,  8.129958883e+01f,
            -1.350774246e+03f,  8.162618472e+01f,  -1.279429014e+03f,  1.474778307e+02f,  -1.284050470e+03f,  1.480762560e+02f,
            -1.222634739e+03f,  2.077550418e+02f,  -1.227016634e+03f,  2.086103115e+02f,  -1.318242769e+03f,  1.134433117e+02f,
            -1.323018509e+03f,  1.139089931e+02f,  -1.224977789e+03f,  2.061549167e+02f,  -1.229365306e+03f,  2.070079803e+02f,
            -1.292658185e+03f,  1.431796196e+02f,  -1.297324653e+03f,  1.437743810e+02f,  -1.358507803e+03f,  7.835057885e+01f,
            -1.363448810e+03f,  7.867433390e+01f,  -1.294528556e+03f,  1.420529069e+02f,  -1.299200071e+03f,  1.426460480e+02f,
            -1.263423552e+03f,  1.768451249e+02f,  -1.267957592e+03f,  1.775935275e+02f,  -1.344848520e+03f,  9.662713171e+01f,
            -1.349727672e+03f,  9.703452110e+01f,  -1.265623953e+03f,  1.753883094e+02f,  -1.270163633e+03f,  1.761344916e+02f,
        };
    }
}
